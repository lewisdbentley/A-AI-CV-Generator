Search As screen:
    OnVisible: |-
        =Clear(FinalFilteredCVs);
        Collect(FinalFilteredCVs, 'CV Generator');
        
        // Set checkboxes
        Set(BPSScheckedSearch, false);
        Set(SCcheckedSearch, false);
        
        // Set filter variables
        Set(varIsSkillsEmpty, true);
        Set(varIsQualificationsEmpty, true);
        Set(varIsRoleEmpty, true);
        Set(varIsCapabilityEmpty, true);
        Set(varIsHubsEmpty, true);
        Set(varIsClientEmpty, true);
        Set(varIsIndustryEmpty, true);
        Set(varSCcheckedSearchEmpty, true);
        Set(varBPSScheckedSearchEmpty, true);
        // Additional conditions can be set similarly
        
        Set(allFiltersEmpty, (varIsSkillsEmpty
            && varIsQualificationsEmpty
            && varIsRoleEmpty
            && varIsCapabilityEmpty
            && varIsHubsEmpty
            && varIsClientEmpty
            && varIsIndustryEmpty
            && varBPSScheckedSearchEmpty
            && varSCcheckedSearchEmpty
            )
        );

    "'(Disabled Button) - blue background side panel_1' As button":
        DisabledBorderColor: =RGBA(51, 51, 51, 1)
        DisabledColor: =RGBA(51, 51, 51, 1)
        Fill: =RGBA(39, 41, 54, 1)
        Height: =662
        HoverBorderColor: =
        HoverColor: =RGBA(51, 51, 51, 1)
        HoverFill: =
        OnSelect: =
        PressedBorderColor: =
        PressedColor: =RGBA(51, 51, 51, 1)
        PressedFill: =
        Text: =""
        Width: =367
        X: =117
        Y: =84
        ZIndex: =1

    "'Rectangle - blue top panel_1' As rectangle":
        Fill: =RGBA(39, 41, 54, 1)
        Height: =96
        Width: =1366
        ZIndex: =2

    "'Label - Professional Experience_1' As label":
        Color: =RGBA(255, 255, 255, 1)
        Font: =Font.Verdana
        FontWeight: =FontWeight.Semibold
        Height: =43
        Size: =24
        Text: ="Search CVs"
        Width: =312
        X: =1054
        Y: =30
        ZIndex: =3

    GalleryFilteredCVs_1 As gallery.galleryVertical:
        DelayItemLoading: =true
        Height: =557
        Items: =FinalFilteredCVs
        Layout: =Layout.Vertical
        LoadingSpinner: =LoadingSpinner.Data
        TemplateSize: =75
        Width: =498
        X: =492
        Y: =109
        ZIndex: =4

        Label9_3 As label:
            Height: =53
            OnSelect: =Select(Parent)
            Text: |-
                =ThisItem.'First Name' & " " & ThisItem.'Last Name' & ", " & ThisItem.Capability & ", " & ThisItem.Hub
                // ThisItem.Photo & " " &
                //& ThisItem.SkillID & " " & " " & LookUp('Example Skills', ThisId=ThisItem.SkillID).Title 
            Width: =482
            X: =148
            ZIndex: =1

        Image1_1 As image:
            Height: =75
            Image: =ThisItem.Photo
            OnSelect: =Select(Parent)
            X: =15
            ZIndex: =2

    ComboBoxSkillSearch As combobox:
        DisplayFields: =["Value"]
        InputTextPlaceholder: =
        Items: =Skills
        OnChange: |-
            =// Set in the OnChange property of the ComboBox
            Set(varIsSkillsEmpty, IsEmpty(ComboBoxSkillSearch.SelectedItems));
        SearchFields: =["Value"]
        SearchItems: =Search(Skills,ComboBoxSkillSearch.SearchText,"Value")
        X: =129
        Y: =397
        ZIndex: =5

    ComboBoxRole As combobox:
        DisplayFields: =["Value"]
        InputTextPlaceholder: =
        Items: =["Associate Consultant","Consultant", "Senior Consultant"]
        OnChange: |-
            =// Set in the OnChange property of the ComboBox
            Set(varIsRoleEmpty, IsEmpty(ComboBoxRole.SelectedItems));
        SearchFields: =["Value"]
        SearchItems: =Search(["Associate Consultant","Consultant", "Senior Consultant"],ComboBoxRole.SearchText,"Value")
        SelectMultiple: =false
        X: =129
        Y: =487
        ZIndex: =6

    Label2_3 As label:
        Color: =RGBA(255, 255, 255, 1)
        Text: ="Skills"
        X: =129
        Y: =352
        ZIndex: =7

    Label2_4 As label:
        Color: =RGBA(255, 255, 255, 1)
        Text: ="Role"
        X: =129
        Y: =442
        ZIndex: =8

    ButtonFilterCVs_1 As button:
        OnSelect: |
            =Clear(FinalFilteredCVs); // Clear the collection to start fresh
            
            Clear(FilteredEmailsForClient); // Clear the collection which filters on Client
            Clear(FilteredClientsInIndustries); // Clear the collection which finds Clients associated with selected industry
            Clear(FilteredClientsInProjects); // Cleawr the collection which finds the CVs which have those Clients
            
            // Generate a collection of emails which have projects with the selected clients
            ClearCollect(
                FilteredEmailsForClient,
                Filter(
                    'CV Generator - Project Experience',
                    'Project Client' in ComboBoxClient.SelectedItems
                ).Email
            );
            
            //Collect the clients associated with these industries into a collection.
            ClearCollect(
                FilteredClientsInIndustries,
                Filter(
                    'CV Generator - Client/Industry',
                    Industry in ComboBoxIndustry.SelectedItems.Value
                ).Client
            );
            
            // Collect the emails of users who worked on a project with these clients
            ClearCollect(
                FilteredClientsInProjects,
                Filter(
                    'CV Generator - Project Experience',
                    'Project Client' in FilteredClientsInIndustries
                )
            );
            
            /* Define variables for conditions
            Set(varIsSkillsEmpty, IsEmpty(ComboBoxSkillSearch.SelectedItems));
            Set(varIsQualificationsEmpty, IsEmpty(ComboBoxQualSearch.SelectedItems));
            Set(varIsRoleEmpty, IsEmpty(ComboBoxRole.SelectedItems));
            Set(varIsCapabilityEmpty, IsEmpty(ComboBoxCapabilitySearch.SelectedItems));
            Set(varIsRadioHubsEmpty, Len(RadioHubsSearch.SelectedText.Value) = 0);
            Set(varIsClientEmpty, IsEmpty(ComboBoxClient.SelectedItems));
            Set(varIsIndustryEmpty, IsEmpty(ComboBoxIndustry.SelectedItems));
            // Additional conditions can be set similarly
            */
            
            // One button to filter them all
            Set(allFiltersEmpty, (varIsSkillsEmpty
                && varIsQualificationsEmpty
                && varIsRoleEmpty
                && varIsCapabilityEmpty
                && varIsHubsEmpty
                && varIsClientEmpty
                && varIsIndustryEmpty
                && varBPSScheckedSearchEmpty
                && varSCcheckedSearchEmpty
                )
            );
            /*
                varIsSkillsEmpty
                && varIsQualificationsEmpty
                && varIsRoleEmpty
                && !SCcheckedSearch
                && !BPSScheckedSearch
                && varIsCapabilityEmpty
                && varIsRadioHubsEmpty,
            */
            // Conditional logic to handle both skills and qualifications
            If(
                allFiltersEmpty,
                Collect(FinalFilteredCVs, 'CV Generator'),
                Collect(
                    FinalFilteredCVs,
                    Filter(
                        'CV Generator',
                        // Client
                        (varIsClientEmpty || Email in FilteredEmailsForClient),
                        // industry
                        (varIsIndustryEmpty || Email in FilteredClientsInProjects.Email),
                        // Skill filter - ony apply if there are selected skills
                        (varIsSkillsEmpty || 
                            CountIf(
                                ComboBoxSkillSearch.SelectedItems,
                                !IsBlank(Find(Text(Value), SkillsString))
                            ) > 0),
                        // Qualification filter - only apply if there are selected qualifications
                        (varIsQualificationsEmpty || 
                            CountIf(
                                ComboBoxQualSearch.SelectedItems,
                                !IsBlank(Find(Text(Value), QualificationsString))
                            ) > 0),
                        // Role Title filter - only apply if role title selected
                        (varIsRoleEmpty || 'Role Title' in ComboBoxRole.SelectedItems),
                        // Apply Security Clearance SC filter based on checkbox
                        (varBPSScheckedSearchEmpty || (!varBPSScheckedSearchEmpty && 'Security Clearance BPSS')),
                        // Apply Security Clearance BPSS filter based on checkbox
                        (varSCcheckedSearchEmpty || (!varSCcheckedSearchEmpty && 'Security Clearance SC'))
                        //(IsBlank(DropdownCapabilitySearch.Selected.Value) || Capability = Text(DropdownCapabilitySearch.Selected.Value))
                        //Hub = RadioHubsSearch.SelectedText.Value
                    )
                )
            );
        Text: |-
            ="Search
            "
        X: =213
        Y: =687
        ZIndex: =9

    ComboBoxQualSearch As combobox:
        DisplayFields: =["Value"]
        InputTextPlaceholder: =
        Items: =Qualifications
        OnChange: |-
            =// Set in the OnChange property of the ComboBox
            Set(varIsQualificationsEmpty, IsEmpty(ComboBoxQualSearch.SelectedItems));
        SearchFields: =["Value"]
        SearchItems: =Search(Qualifications,ComboBoxQualSearch.SearchText,"Value")
        X: =129
        Y: =580
        ZIndex: =10

    Label2_5 As label:
        Color: =RGBA(255, 255, 255, 1)
        Text: ="Qualifications"
        X: =129
        Y: =532
        ZIndex: =11

    Icon5_3 As icon.Search:
        Color: =RGBA(255, 255, 255, 1)
        Height: =72
        Icon: =Icon.Search
        Width: =53
        X: =990
        Y: =16
        ZIndex: =14

    Profile_1 As label:
        Color: =RGBA(39, 41, 54, 1)
        Font: =Font.Verdana
        FontWeight: =FontWeight.Semibold
        Height: =122
        Size: =36
        Text: ="Your Profile"
        Visible: =false
        Width: =397
        X: =122
        Y: =130
        ZIndex: =15

    DropdownCapabilitySearch As dropdown:
        AllowEmptySelection: =true
        ChevronBackground: =RGBA(215, 223, 240, 1)
        ChevronFill: =RGBA(0, 18, 107, 1)
        Color: =RGBA(0, 18, 107, 1)
        Default: =""""""
        Fill: =RGBA(215, 223, 240, 1)
        Font: =Font.Verdana
        Items: =["Data & AI Strategy", "Data & AI Innovation", "Data & AI Factory", "Data & AI Enablement"]
        OnChange: =
        SelectionColor: =RGBA(0, 18, 107, 1)
        SelectionFill: =RGBA(215, 223, 240, 1)
        Size: =12
        Visible: =false
        X: =129
        Y: =212
        ZIndex: =16

    "'Primary Alignment_2' As dropdown":
        ChevronBackground: =RGBA(215, 223, 240, 1)
        ChevronFill: =RGBA(0, 18, 107, 1)
        Color: =RGBA(0, 18, 107, 1)
        Fill: =RGBA(215, 223, 240, 1)
        Font: =Font.Verdana
        Items: |
            =["Primary Alignment","frog", "Intelligent Industry", "Corporate Experience", "W&O", "BT", "Analytics & AI", "Financial Service", "Manufacturing", "Automotive and Life Sciences", "Utilities & Energy", "TMTS", "Public Sector", "Consumer Products & Retail", "Sustainable Futures"]
        SelectionColor: =RGBA(0, 18, 107, 1)
        SelectionFill: =RGBA(215, 223, 240, 1)
        Size: =12
        Visible: =false
        X: =116
        Y: =182
        ZIndex: =17

    Label9_1 As label:
        Color: =RGBA(255, 255, 255, 1)
        Font: =Font.Verdana
        Text: |-
            ="Capability:"
        Width: =334
        X: =125
        Y: =187
        ZIndex: =18

    RadioHubsSearch As radio:
        Color: =RGBA(255, 255, 255, 1)
        FontWeight: =FontWeight.Lighter
        HoverColor: =RGBA(219, 219, 219, 1)
        Items: |-
            =If(
                varIsCapabilityEmpty,
                [],
                LookUp(HubOptionSets, Capability = ComboBoxCapabilitySearch.Selected.Value).Options
            )
        OnChange: |
            =// First, check if the Radio control has items
            If(
                !varIsCapabilityEmpty,
                0,
                // Optionally handle the case when no items are present
                Set(varIsRadioHubsEmpty, true) // or false, depending on your logic
            );
        Visible: =false
        Width: =371
        X: =116
        Y: =284
        ZIndex: =19

    Group4 As group:
        Height: =5
        Width: =5
        X: =40
        Y: =60
        ZIndex: =19

        Checkbox_BPSS_Search_1 As checkbox:
            CheckboxSize: =30
            Color: =RGBA(255, 255, 255, 1)
            Height: =40
            OnCheck: =Set(varBPSScheckedSearchEmpty,false)
            OnUncheck: =Set(varBPSScheckedSearchEmpty,true)
            Text: ="BPSS"
            Width: =121
            X: =174
            Y: =633
            ZIndex: =12

        Checkbox_SC_Search_1 As checkbox:
            CheckboxSize: =30
            Color: =RGBA(255, 255, 255, 1)
            Height: =40
            OnCheck: =Set(varSCcheckedSearchEmpty,false)
            OnUncheck: =Set(varSCcheckedSearchEmpty,true)
            Text: ="SC"
            Width: =121
            X: =304
            Y: =633
            ZIndex: =13

    Label11_1 As label:
        Color: =RGBA(255, 255, 255, 1)
        Font: =Font.Verdana
        Text: |-
            ="Hub:"
        Visible: =false
        X: =134
        Y: =261
        ZIndex: =20

    ComboBoxCapability As combobox:
        DisplayFields: =["Value"]
        IsSearchable: =false
        Items: =["All", "Data & AI Strategy", "Data & AI Innovation", "Data & AI Factory", "Data & AI Enablement"]
        SearchFields: =["Value"]
        SearchItems: =[]
        SelectMultiple: =false
        Visible: =false
        X: =985
        Y: =190
        ZIndex: =22

    ComboBoxClient As combobox:
        DisplayFields: =["Client"]
        InputTextPlaceholder: =
        Items: ='CV Generator - Client/Industry'.Client
        OnChange: |-
            =// Set in the OnChange property of the ComboBox
            Set(varIsClientEmpty, IsEmpty(ComboBoxClient.SelectedItems));
        SearchFields: =["Client"]
        SearchItems: =Search('CV Generator - Client/Industry'.Client,ComboBoxClient.SearchText,"Client")
        X: =129
        Y: =142
        ZIndex: =24

    Gallery5 As gallery.galleryVertical:
        DelayItemLoading: =true
        Height: =308
        Items: =FilteredClientsInProjects
        Layout: =Layout.Vertical
        LoadingSpinner: =LoadingSpinner.Data
        TemplateSize: =95
        Width: =366
        X: =985
        Y: =116
        ZIndex: =25

        Label18 As label:
            Height: =46
            OnSelect: =Select(Parent)
            Text: =ThisItem.Email
            Width: =433
            X: =12
            Y: =24
            ZIndex: =1

        "Icon10 As icon.'3DPrinting'":
            Icon: =Icon.Printing3D
            OnSelect: =Select(Parent)
            X: =540
            Y: =24
            ZIndex: =2

    ComboBoxIndustry As combobox:
        DisplayFields: =["Value"]
        Items: |
            =["MALS", "CPRD", "Govt", "FS", "ET&U", "TMTS"]
        OnChange: |-
            =// Set in the OnChange property of the ComboBox
            Set(varIsIndustryEmpty, IsEmpty(ComboBoxIndustry.SelectedItems));
        SearchFields: =["Value"]
        SearchItems: |-
            =Search(["MALS", "CPRD", "Govt", "FS", "ET&U", "TMTS"]
            ,ComboBoxIndustry.SearchText,"Value")
        X: =129
        Y: =52
        ZIndex: =26

    Label19 As label:
        Color: =RGBA(255, 255, 255, 1)
        Text: ="Client"
        X: =129
        Y: =97
        ZIndex: =27

    Label20 As label:
        Color: =RGBA(255, 255, 255, 1)
        Text: ="Industry"
        X: =127
        Y: =7
        ZIndex: =28

    Label14 As label:
        Text: |-
            ="# Rows: " & CountRows(GalleryFilteredCVs_1.AllItems)
        X: =656
        Y: =706
        ZIndex: =29

    Label3 As label:
        Height: =39
        Text: |-
            ="Filters on: " & !allFiltersEmpty
        Width: =179
        X: =783
        Y: =706
        ZIndex: =30

    Label8 As label:
        Text: |-
            ="Qual empty: " & IsEmpty(ComboBoxQualSearch.SelectedItems)
        Width: =200
        X: =925
        Y: =706
        ZIndex: =31

    Label8_1 As label:
        Text: |-
            ="Skill empty: " & IsEmpty(ComboBoxSkillSearch.SelectedItems)
        X: =930
        Y: =619
        ZIndex: =32

    Label8_2 As label:
        Text: |-
            ="Role empty: " & IsEmpty(ComboBoxRole.SelectedItems)
        X: =930
        Y: =659
        ZIndex: =33

    Label8_3 As label:
        Height: =36
        Text: |-
            ="Capability empty: " & IsEmpty(ComboBoxCapabilitySearch.SelectedItems)
        Width: =226
        X: =930
        Y: =587
        ZIndex: =34

    ComboBoxCapabilitySearch As combobox:
        DisplayFields: =["Value"]
        Items: =["Data & AI Strategy", "Data & AI Innovation", "Data & AI Factory", "Data & AI Enablement"]
        OnChange: |-
            =// Set in the OnChange property of the ComboBox
            Set(varIsCapabilityEmpty, IsEmpty(ComboBoxCapabilitySearch.SelectedItems));
        SearchFields: =["Value"]
        SearchItems: =Search(["Data & AI Strategy", "Data & AI Innovation", "Data & AI Factory", "Data & AI Enablement"],ComboBoxCapabilitySearch.SearchText,"Value")
        SelectMultiple: =false
        X: =127
        Y: =222
        ZIndex: =35

    Label8_4 As label:
        Height: =36
        Text: |-
            ="Hubs empty: " & (Len(RadioHubsSearch.SelectedText.Value) = 0)
        Width: =226
        X: =930
        Y: =545
        ZIndex: =36

    Label8_5 As label:
        Height: =36
        Text: |-
            ="Client empty: " & IsEmpty(ComboBoxClient.SelectedItems)
        Width: =226
        X: =930
        Y: =507
        ZIndex: =37

    Label8_6 As label:
        Height: =36
        Text: |-
            ="industry empty: " & IsEmpty(ComboBoxIndustry.SelectedItems)
        Width: =226
        X: =930
        Y: =471
        ZIndex: =38

    Label8_7 As label:
        Text: |-
            ="Qual empty: " & varIsQualificationsEmpty
        Width: =200
        X: =1125
        Y: =614
        ZIndex: =39

    Label8_8 As label:
        Text: |-
            ="Skill empty: " & varIsSkillsEmpty
        X: =1130
        Y: =541
        ZIndex: =40

    Label8_9 As label:
        Text: |-
            ="Role empty: " & varIsRoleEmpty
        X: =1125
        Y: =574
        ZIndex: =41

    Label8_10 As label:
        Height: =36
        Text: |-
            ="Capability empty: " & varIsCapabilityEmpty
        Width: =226
        X: =1130
        Y: =495
        ZIndex: =42

    Label8_11 As label:
        Height: =36
        Text: |-
            ="Hubs empty: " & varIsHubsEmpty
        Width: =226
        X: =1130
        Y: =453
        ZIndex: =43

    Label8_12 As label:
        Height: =36
        Text: |-
            ="Client empty: " & varIsClientEmpty
        Width: =226
        X: =1130
        Y: =415
        ZIndex: =44

    Label8_13 As label:
        Height: =36
        Text: |-
            ="industry empty: " & varIsIndustryEmpty
        Width: =226
        X: =1130
        Y: =379
        ZIndex: =45

    ComboBoxHubs As combobox:
        DisplayFields: =[""]
        IsSearchable: =false
        Items: |-
            =If(
                varIsCapabilityEmpty,
                [],
                LookUp(HubOptionSets, Capability = ComboBoxCapabilitySearch.Selected.Value).Options
            )
        OnChange: |-
            =// Set in the OnChange property of the ComboBox
            Set(varIsHubsEmpty, IsEmpty(ComboBoxHubs.SelectedItems));
        SearchFields: =[""]
        SearchItems: =[]
        X: =129
        Y: =307
        ZIndex: =47

    Label13 As label:
        Color: =RGBA(255, 255, 255, 1)
        Text: ="Hub"
        X: =127
        Y: =267
        ZIndex: =48

    Label8_14 As label:
        Height: =36
        Text: |-
            ="BPSS empty: " & varBPSScheckedSearchEmpty
        Width: =226
        X: =1130
        Y: =695
        ZIndex: =49

    Label8_15 As label:
        Height: =36
        Text: |-
            ="SC empty: " & varSCcheckedSearchEmpty
        Width: =226
        X: =1130
        Y: =659
        ZIndex: =50

    Button7 As button:
        OnSelect: |-
            =ForAll(
                FinalFilteredCVs,
                    Patch(
                        Table_query__1,
                        ThisRecord
                    )
            )
        Text: |-
            ="Export
            "
        X: =541
        Y: =609
        ZIndex: =51

